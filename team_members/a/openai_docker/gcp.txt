# gcp docker 
# í´ë” êµ¬ì¡° í™•ì¸ 
ls

# ê¹ƒ ì„¤ì¹˜ í™•ì¸
(myenv) areum@codeit-ai5-4team:~$ git --version
git version 2.43.0


# í´ë” í†µì§¸ë¡œ ì‚­ì œ í›„ git clone
rm -rf Bidding-Mate
git clone https://github.com/íŒ€ë ˆí¬ì£¼ì†Œ.git
rm -rf Bidding-Mate
git clone https://github.com/arumshin-dev/Bidding-Mate.git

# í´ë”ì•ˆì— íŒŒì¼ë“¤ ì´ë™í•˜ê³  
mv /home/areum/raw/* /home/areum/Bidding-Mate/data/raw/

#ê°œì¸ì ìœ¼ë¡œ ë§Œë“  íŒŒì¼, ê°€ìƒí™˜ê²½ ì‚­ì œ
rm -rf myenv
rm data_list.csv
rm gpt5.ipynb
rm hwp_table_rag.ipynb
rm untitled1.txt
rm -rf raw

# ë„ì»¤ ì„¤ì¹˜ í™•ì¸
(myenv) areum@codeit-ai5-4team:~$ docker --version
Command 'docker' not found, but can be installed with:
snap install docker         # version 28.4.0, or
apt  install docker.io      # version 28.2.2-0ubuntu1~24.04.1
apt  install podman-docker  # version 4.9.3+ds1-1ubuntu0.2
See 'snap info docker' for additional versions.

# root ê¶Œí•œ í™•ì¸
sudo whoami

root â†’ Docker ì„¤ì¹˜ ê°€ëŠ¥
areum is not in the sudoers file â†’ Docker ì„¤ì¹˜ ë¶ˆê°€

# ë„ì»¤ ì„¤ì¹˜
sudo apt install docker.io
# ë„ì»¤ ì„¤ì¹˜ í™•ì¸
docker --version
# Docker ë°ëª¬ ì‹¤í–‰ ì—¬ë¶€ í™•ì¸:
sudo systemctl status docker
ë§Œì•½ inactiveë¼ë©´:

# ë„ì»¤ ì‹¤í–‰
sudo systemctl start docker
Dockerê°€ ì •ìƒ ì‘ë™í•˜ë©´:

# ë„ì»¤ ì‹¤í–‰
docker run hello-world
# ë„ì»¤ ì‚­ì œ
sudo docker rmi hello-world

# ë„ì»¤ ì´ë¯¸ì§€ í™•ì¸
docker ps -a
# ë„ì»¤ ê·¸ë£¹ì— í˜„ì¬ ì‚¬ìš©ì ì¶”ê°€ 
sudo usermod -aG docker $user

# ë„ì»¤ ë„ê¸°
sudo systemctl stop docker
# ì¼œê¸°
sudo systemctl start docker
# ì¬ì‹œì‘
sudo systemctl restart docker
# ìƒíƒœ í™•ì¸
sudo systemctl status docker

# ë„ì»¤ ê·¸ë£¹ì— ì˜ ë“¤ì–´ê°”ëŠ”ì§€ í™•ì¸
groups

# ì£¼í”¼í„° ì„œë²„ ì¬ì‹œì‘
pkill -u areum

# ì´ë¯¸ì§€ ë¹Œë“œ
sudo docker build -t myapp ./Bidding-Mate/team_members/a/openai_docker
# docker build -f Dockerfile.dev -t myapp .

# ë¹Œë“œëœ ì´ë¯¸ì§€ í™•ì¸
areum@codeit-ai5-4team:~/Bidding-Mate$ docker images
REPOSITORY        TAG                             IMAGE ID       CREATED         SIZE
myapp             latest                          1bd745f524e2   2 minutes ago   6.57GB
hello-world       latest                          1b44b5a3e06a   4 months ago    10.1kB
pytorch/pytorch   2.6.0-cuda12.4-cudnn9-runtime   40472de84a38   10 months ago   6.06GB

# ë„ì»¤ ì‹¤í–‰
docker run myapp

docker ps -a

cd Bidding-Mate
git status

git config --global user.email "arumshin.dev@gmail.com"
git config --global user.name "arum"

# ê¹ƒ ì„¤ì • í™•ì¸
git config --global --list

git status
git add .
git commit -m "Add docker environment"
git push


# ë„ì»¤ í´ë”ë¡œ ì´ë™
cd Bidding-Mate/team_members/a/openai_docker

# ë„ì»¤ ì´ë¯¸ì§€ì•ˆì— ìˆ˜ì •í•œ íŒŒì¼ ë°˜ì˜í•˜ë ¤ë©´ ë‹¤ì‹œ ì´ë¯¸ì§€ ë§Œë“¤ì–´ì•¼í•¨
docker build -t myapp .

# ì»¨í…Œì´ë„ˆ ì•ˆì— ë“¤ì–´ê°€ì„œ ì§ì ‘ íŒŒì¼ë“¤ì´ ì˜ ë“¤ì–´ê°”ëŠ”ì§€ í™•ì¸
docker run -it myapp bash
ls
ls /work


# ì‹¤í–‰
docker run myapp


docker build -t myapp .
docker run myapp 
docker run -e OPENAI_API_KEY=sk-xxxx myapp
docker run -e OPENAI_API_KEY=sk-p~ myapp

cd /home/areum/Bidding-Mate
docker build -f team_members/a/openai_docker/Dockerfile -t myapp .


cd Bidding-Mate/team_members/a/openai_docker
docker run myapp 

docker run -it myapp bash 
ls -al /work

#6) ë¡œì»¬ì—ì„œë„ ë²¡í„°DB íŒŒì¼ì„ ë³´ê³  ì‹¶ë‹¤ë©´?
#ë‘ ê°€ì§€ ë°©ë²•ì´ ìˆì–´.

#ë°©ë²• A) Docker volumeìœ¼ë¡œ ë¡œì»¬ì— ì €ì¥
docker run -v $(pwd)/data:/work/data myapp

#########################################################################################
docker images
# íƒœê·¸ì—†ëŠ” ì´ë¯¸ì§€ ì‚­ì œ
docker image prune

docker ps -a
# íƒœê·¸ì—†ëŠ” ì»¨í…Œì´ë„ˆ ì‚­ì œ
docker container prune

docker image rm myapp
cd /home/areum/Bidding-Mate
docker build -f team_members/a/openai_docker/Dockerfile -t myapp .

#ì‹¤í–‰ ëë‚˜ë©´ ì»¨í…Œì´ë„ˆ ê¸°ë¡ì´ ìë™ ì‚­ì œ, ì±—ë´‡ì²˜ëŸ¼ ì…ë ¥
docker run -it --rm myapp


# ë²¡í„°DB(.pkl)ì€ ì´ë¯¸ì§€ì— ë„£ì§€ ì•Šê³  ë³¼ë¥¨ìœ¼ë¡œ ë§ˆìš´íŠ¸
docker run -it --rm -v $(pwd)/data:/work/data myapp
docker run -it --rm -v $(pwd)/data:/work/data myapp

docker cp <ì»¨í…Œì´ë„ˆID>:/path/in/container/vector_db.pkl ./vector_db.pkl
docker cp <ì»¨í…Œì´ë„ˆID>:/path/in/container/vector_db.pkl ./vector_db.pkl
docker cp a2be91090da6:/work/data/vector_db.pkl ./vector_db.pkl
docker cp a2be91090da6:/work/data/pdf4db.pkl ./pdf4db.pkl
docker cp a2be91090da6:/work/data/testdb.pkl ./testdb.pkl

docker exec -it a2be91090da6 /bin/bash
# ls -R /work/data # ë„ˆë¬´ ë§ì´ ë‚˜ì˜´
find / -name "*.pkl" 2>/dev/null 

docker cp a2be91090da6:/work/pdf4db.pkl ./pdf4db.pkl
docker cp a2be91090da6:/work/testdb.pkl ./testdb.pkl

# ì‚­ì œí•˜ê³  ë¹Œë“œ docker rmi -f myapp:latest && docker build -t myapp .
docker rmi -f myapp:latest && \
docker build -f team_members/a/openai_docker/Dockerfile -t myapp . && \
docker run -it --rm \
  -v $(pwd)/data:/work/data \
  --env-file /home/areum/Bidding-Mate/.env \
  myapp

------------------------------------
# ìºì‹œ ì—†ì´ ë¹Œë“œ
docker build --no-cache -f team_members/a/openai_docker/Dockerfile -t myapp . && \
docker run -it --rm \
  -v $(pwd)/data:/work/data \
  --env-file /home/areum/Bidding-Mate/.env \
  myapp

--------------------
cd /home/areum/Bidding-Mate 
docker images rm myapp
docker build -f team_members/a/openai_docker/Dockerfile -t myapp .

docker run -it --rm \
  -v $(pwd)/data:/work/data \
  --env-file /home/areum/Bidding-Mate/.env \
  myapp
--------------------------------------
  ğŸ”¹ ìŠ¤í¬ë¦½íŠ¸ë¡œ ìë™í™”
í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— rebuild.sh ê°™ì€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë§Œë“¤ì–´ë‘ë©´ í¸í•©ë‹ˆë‹¤:

bash
#!/bin/bash
set -e
cd /home/areum/Bidding-Mate

docker rmi -f myapp:latest || true
docker build -f team_members/a/openai_docker/Dockerfile -t myapp .
docker run -it --rm \
  -v $(pwd)/data:/work/data \
  --env-file /home/areum/Bidding-Mate/.env \
  myapp
ì‹¤í–‰ ê¶Œí•œì„ ì£¼ê³ :

bash
chmod +x rebuild.sh
ì´ì œëŠ” ê·¸ëƒ¥:

bash
./rebuild.sh
ë§Œ ì¹˜ë©´ ë©ë‹ˆë‹¤.

docker ps -a
docker attach myapp:latest




docker rmi -f chroma:v1.0.0 || true
docker build -f team_members/a/openai_docker/Dockerfile_chroma -t chroma:v1.0.0 .
docker run -it --rm \
  -v $(pwd)/data:/work/data \
  --env-file /home/areum/Bidding-Mate/.env \
  chroma:v1.0.0

docker attach chroma:v1.0.0

"docker rmi -f chroma:v1.0.0 || true
docker build -f team_members/a/openai_docker/Dockerfile_chroma -t chroma:v1.0.0 .
docker run -it --rm \
  -v $(pwd)/data:/work/data \
  -v $(pwd)/team_members/a/chroma_db:/work/chroma_db \
  --env-file /home/areum/Bidding-Mate/.env \
  chroma:v1.0.0"



docker build -f team_members/a/openai_docker/Dockerfile -t a:v1 .
docker run -it --rm \
  -v $(pwd)/team_members/a/openai_docker:/work \
  -v $(pwd)/data:/work/data \
  -v $(pwd)/team_members/a/chroma_db:/work/chroma_db \
  --env-file /home/areum/Bidding-Mate/.env \
  a:v1

